<template>
  <require from="common/controls/pager"></require>
  <require from="common/converters/lookup-to-id-value-converter"></require>

  <ai-dialog>

    <ai-dialog-header>
      <h3>${header}</h3>
    </ai-dialog-header>

    <ai-dialog-body>
      <div class="panel panel-default">
        <div class="panel-body">
          <form class="form-horizontal" role="form">

            <div class="form-group">
              <label class="control-label col-sm-4">Paid On:</label>
              <div class="col-sm-8">
                <input type="text" class="form-control" placeholder="Enter Batch Number" value.bind="batchNumber" />
              </div>
            </div>

            <div>
              <!-- list -->
              <table class="table table-striped table-hover table-condensed">

                <thead>
                  <tr class="row-no-padding">
                    <th class="col-sm-2">Action</th>
                    <th class="col-sm-2">Product</th>
                    <th class="col-sm-1 text-right">Ordered</th>
                    <th class="col-sm-1 text-right">Received</th>
                    <th class="col-sm-3 text-right">Expiry</th>
                    <th class="col-sm-3 text-right">Receiving</th>
                  </tr>
                </thead>

                <tbody>
                  <tr repeat.for="item of receivablePage.items" click.delegate="editItem(item)">
                    <td>
                      <a href="javascript:undefined" class="text-info" click.delegate="editItem(item)">
                        <i class="fa fa-pencil"></i>
                      </a>
                      <a href="javascript:undefined" class="text-danger" click.delegate="resetItem(item)">
                        <i class="fa fa-refresh"></i>
                      </a>
                    </td>

                    <td>${item.product.name}</td>
                    <td class="text-right">${item.orderedQuantity}</td>
                    <td class="text-right">${item.receivedQuantity}</td>

                    <!-- read-only mode -->
                    <td if.bind="$parent.selectedItem !== item" class="text-right">${item.expiresOn}</td>
                    <td if.bind="$parent.selectedItem !== item" class="text-right">${item.receivingQuantity}</td>

                    <!-- edit mode -->
                    <td if.bind="$parent.selectedItem === item" class="text-right">
                      <input class="form-control text-right" type="date" value.bind="item.expiresOn" />
                    </td>
                    <td if.bind="$parent.selectedItem === item" class="text-right">
                      <input class="form-control text-right" type="number" value.bind="item.receivingQuantity" />
                    </td>
                  </tr>
                </tbody>

              </table>

              <!-- pager -->
              <pager current-page.bind="receivablePage.offset" total-items.bind="receivablePage.count" change.delegate="receivablePage.doPage($event)" />

            </div>

          </form>
        </div>
      </div>
    </ai-dialog-body>

    <ai-dialog-footer>
      <button type="button" class="btn btn-success" click.trigger="save()" disabled.bind="!canSave">
        <i class="fa fa-check-circle"></i> Save
      </button>
      <button type="button" class="btn btn-danger" click.trigger="cancel()">
        <i class="fa fa-times-circle"></i> Cancel</button>
    </ai-dialog-footer>

  </ai-dialog>

</template>